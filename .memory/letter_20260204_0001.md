# Letter to Myself (Session Handoff)

**Date:** 2026-02-04 23:35 CET

## 1. Executive Summary
* **Goal:** Migrate Aurus Voice Intelligence from desktop-only (Tauri + Next.js) to a cross-platform mobile-ready architecture while maintaining desktop build compatibility.
* **Current Status:** Completed Phase 1 Task 1 (architecture analysis) and Phase 2 partial (secrets.rs security fix). Ready to proceed with Phase 1 Task 2 (mobile build targets).

## 2. The "Done" List (Context Anchor)
* Created `src-tauri/src/platform/` abstraction layer with unified `SecureStorage` trait
* Implemented `platform/secrets/apple.rs` - macOS/iOS Keychain via `security-framework` crate
* Implemented `platform/secrets/windows.rs` - Windows Credential Manager via `windows` crate
* Implemented `platform/secrets/linux.rs` - Secret Service (GNOME Keyring) via `secret-service` crate
* Implemented `platform/secrets/android.rs` - Android Keystore via JNI (EncryptedSharedPreferences)
* Rewrote `src-tauri/src/secrets.rs` to use platform abstraction instead of plaintext JSON file
* Updated `src-tauri/src/lib.rs` with conditional compilation for mobile (gated audio.rs, tts.rs)
* Updated `src-tauri/src/transcription.rs` with `#[cfg]` gates for Whisper (desktop-only)
* Updated `src-tauri/Cargo.toml` with platform-specific dependencies
* All 33 tests pass, release build succeeds

## 3. The "Pain" Log (CRITICAL)
* **Tried:** Separating `tauri` dependency into target-specific sections to remove `macos-private-api` on non-macOS
* **Failed:** Tauri build script requires features to match `tauri.conf.json` exactly
* **Workaround:** Keep `macos-private-api` in main dependency (ignored on other platforms)
* *Note:* Don't try to conditionally include Tauri features per-platform - the build system doesn't support it.

* **Tried:** Running `cargo check` after initial changes
* **Failed:** Stale build cache pointed to old project path (`/Users/oliverbaer/Projects/ai-voiceagent/`)
* **Workaround:** `cargo clean` then rebuild
* *Note:* If you see "failed to read plugin permissions" with wrong path, clean the build cache.

## 4. Active Variable State
* Working directory: `/Users/oliverbaer/Projects/aurus-voiceintelligence/src-tauri`
* Old insecure API key file exists: `~/Library/Application Support/voice-intelligence-hub/.api_keys` (plaintext JSON)
* Users need to migrate keys to Keychain and delete old file manually

## 5. Immediate Next Steps
1. [ ] Phase 1, Task 2: Add mobile build targets to `tauri.conf.json` (iOS bundle ID, Android package, permissions)
2. [ ] Phase 1, Task 3: Test Next.js static export compatibility with mobile WebView
3. [ ] Phase 1, Task 4: Create mobile-specific CI/CD pipeline (GitHub Actions for iOS/Android builds)
4. [ ] Phase 3: Evaluate CPAL mobile alternatives or implement native audio bridges
5. [ ] Consider adding data migration command to move keys from old JSON file to Keychain
