# Letter to Myself (Session Handoff)

**Date:** 2026-02-05 14:50 CET

## 1. Executive Summary
* **Goal:** Migrate Aurus Voice Intelligence from desktop-only (Tauri + Next.js) to cross-platform mobile-ready architecture supporting iOS/Android while maintaining desktop builds.
* **Current Status:** Completed Phases 1-4. Phase 3 (Audio Pipeline) just finished. All builds and tests passing.

## 2. The "Done" List (Context Anchor)

### Phase 1: Foundation ✅
* Created `src-tauri/src/platform/mod.rs` - platform abstraction module
* Created `src-tauri/src/platform/secrets/mod.rs` - SecureStorage trait
* Created `src-tauri/src/platform/secrets/apple.rs` - macOS/iOS Keychain
* Created `src-tauri/src/platform/secrets/windows.rs` - Windows Credential Manager
* Created `src-tauri/src/platform/secrets/linux.rs` - Linux Secret Service
* Created `src-tauri/src/platform/secrets/android.rs` - Android Keystore stub
* Created `src-tauri/capabilities/mobile.json` - mobile Tauri permissions
* Created `docs/MOBILE_SETUP.md` - setup guide
* Created `app/hooks/usePlatform.ts` - frontend platform detection

### Phase 2: Security Layer ✅
* Rewrote `src-tauri/src/secrets.rs` to use platform abstraction
* Fixed Keychain "could not be found" error pattern in `apple.rs:72`

### Phase 3: Audio Pipeline Mobile Adaptation ✅ (THIS SESSION)
* Created `src-tauri/src/platform/audio/mod.rs` - AudioCapture trait, AudioCaptureError, AudioChunk
* Created `src-tauri/src/platform/audio/desktop.rs` - CPAL implementation with resampling
* Created `src-tauri/src/platform/audio/mobile.rs` - Mobile stub returning NotSupported
* Updated `src-tauri/src/platform/mod.rs` - added audio module exports
* Created `app/hooks/useWebAudioCapture.ts` - Web Audio API for mobile capture

### Phase 4: On-Device AI Infrastructure ✅
* Created `app/workers/ai-worker.ts` - Web Worker for Transformers.js
* Created `app/hooks/useLocalAI.ts` - React hook for inference

## 3. The "Pain" Log (CRITICAL)

* **Tried:** Callback type `Box<dyn Fn(AudioChunk) + Send>` in AudioCapture trait
* **Failed:** "dyn Fn cannot be shared between threads safely" when wrapped in Arc
* **Workaround:** Changed to `Box<dyn Fn(AudioChunk) + Send + Sync>`
* *Note:* Arc<T> requires T: Sync for Arc itself to be Send across threads

* **Tried:** Using `is_recording` Arc in both inner cpal closure and outer while loop
* **Failed:** "borrow of moved value: is_recording" - moved into closure
* **Workaround:** Clone to `is_recording_inner` before thread spawn, use original in while loop
* *Note:* Always clone Arc before moving into closures if needed elsewhere

## 4. Active Variable State
* Working directory: `/Users/oliverbaer/Projects/aurus-voiceintelligence`
* Build status: All passing (`cargo check`, `pnpm build`)
* Test status: 7/7 Rust tests, 33/33 frontend tests
* Dependencies: All installed via `pnpm install`
* Existing `send_audio_to_deepgram` command bridges mobile Web Audio to Rust

## 5. Immediate Next Steps
1. [ ] Phase 5: Design Yjs + WebRTC sync architecture for Desktop ↔ Mobile
2. [ ] Phase 6: Add mobile-specific tests for useWebAudioCapture and usePlatform
3. [ ] Install iOS SDK and run `pnpm tauri ios init` with Apple Team ID
4. [ ] Install Android SDK and run `pnpm tauri android init`
5. [ ] Test useWebAudioCapture hook in mobile simulator
6. [ ] Create GitHub Actions workflow for mobile CI/CD
7. [ ] Test Transformers.js worker initialization in browser
